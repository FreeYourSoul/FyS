<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FreeYourSoul Online: Cache Manager Library (CML)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="choco.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FreeYourSoul Online
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   <div id="projectbrief">MMORPG</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Cache Manager Library (CML) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is a library that is used in order to retrieve data from the database, and cache it in order to not have expensive db call. <br  />
</p>
<p>For example; <br  />
 in the case of the Arena Service (<a href="services/Arena_BattleSystem.md#arena">Battle service</a>). At the start of a battle, the contenders (monsters) that the player are facing are selected and thus known. The Service will have to fetch how the contenders behaviour are (stats, attacks, artificial intelligence and so on..), this logic is stored as chai scripts in the DB. When the battle end, if necessary, the memory is flushed for the next battle (new contenders / actions to fetch). <br  />
 But in case the same contender is selected for the next fight, it would be a waster to retrieve the behaviours twice in the database. <br  />
</p>
<h1>To resolve this issue : CML is composed of 3 distincts steps:</h1>
<ul>
<li>Retrieve from the database</li>
<li>Create a at a specified file system location a folder hierarchy in order to find the contender again if needed.</li>
<li>If the scripts is considered as "hot" (often used), it is kept in memory and not flushed at the end of the battle.</li>
</ul>
<p>Thanks to those 3 steps, in the second attempt to retrieve the contender data.</p><ol type="1">
<li>First it will be checked if it is a hot scripts (basically contenders are not hot scripts, but actions like attacks are).</li>
<li>If it is not a hot script, the local file system is checking for the existance of the file that should correspond the script. <br  />
</li>
<li>If it is found, it will be loaded, otherwise the database is requested.</li>
</ol>
<p><img src="../docs/assets/conditionalDiagramCML.png" alt="conditionalDiagramCML" class="inline"/></p>
<h1>Up to date</h1>
<p>In order to not have not up to date scripts stored in the file system. Two mecanisms are possible:</p><ul>
<li>Cleanup of the script at back-end startup (to enforce new database fetch)</li>
<li>Redownload from database of the scripts stored on the file system at the back-end startup (to ensure up to date data). </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
